{% extends 'base.html' %}

{% block content %}
    {% include 'head.html' with bootstrap=True %}

    <div class="d-flex flex-column justify-content-center align-items-center">
        <section id="create-schedule" class="p-2 m-5">
            <h2 class="text-center">–°—ä–∑–¥–∞–π —Ä–µ–ø–æ—Ä—Ç</h2>

            <div class="d-flex flex-column justify-content-center align-items-center">

                <!-- üîΩ Download template -->
                <div style="margin-bottom: 20px;">
                    <a href="{{ template_absence_file }}"
                       class="btn px-5 py-2 m-2 btn-primary text-center"
                       download>
                        –°–≤–∞–ª–∏ –®–∞–±–ª–æ–Ω
                    </a>
                </div>

                {% if error %}
                    <p style="color:red;">{{ error }}</p>
                {% endif %}

                <form method="post"
                      class="d-flex flex-column align-items-center"
                      enctype="multipart/form-data">
                    {% csrf_token %}

                    <label class="mb-2">–ö–∞—á–∏ –ø–æ–ø—ä–ª–Ω–µ–Ω —Ñ–∞–π–ª:</label>

                    <div class="d-flex align-items-center gap-3">
                        <label class="btn btn-outline-secondary rounded-3 mb-0">
                            Choose file
                            <input type="file"
                                   name="file"
                                   accept=".xlsm"
                                   required
                                   hidden
                                   onchange="updateFileName(this)">
                        </label>

                        <span id="file-name" class="text-muted">–ù—è–º–∞ –∏–∑–±—Ä–∞–Ω —Ñ–∞–π–ª</span>
                    </div>

                    <button id="submit-btn"
                            class="px-5 py-2 mt-4 btn btn-primary rounded-3"
                            type="submit">
                        –ì–µ–Ω–µ—Ä–∏—Ä–∞–π —Ä–µ–ø–æ—Ä—Ç
                    </button>
                </form>

{#                <!-- ‚úÖ Fake Progress Bar -->#}
{#                <div id="progress-wrapper" class="w-100 mt-4" style="max-width: 400px; display: none;">#}
{#                    <div class="progress">#}
{#                        <div#}
{#                            id="progress-bar"#}
{#                            class="progress-bar progress-bar-striped progress-bar-animated"#}
{#                            role="progressbar"#}
{#                            style="width: 0%">#}
{#                            0%#}
{#                        </div>#}
{#                    </div>#}
{#                    <p class="text-center mt-2 text-muted">Processing & downloading...</p>#}
{#                </div>#}

            </div>
        </section>
    </div>

<script>
    function updateFileName(input) {
        const fileName = input.files.length
            ? input.files[0].name
            : "No file chosen";
        document.getElementById("file-name").textContent = fileName;
    }

    {#function startFakeProgress() {#}
    {#    const wrapper = document.getElementById("progress-wrapper");#}
    {#    const bar = document.getElementById("progress-bar");#}
    {#    const btn = document.getElementById("submit-btn");#}
    {##}
    {#    document.body.classList.add("loading");#}
    {##}
    {#    wrapper.style.display = "block";#}
    {#    btn.disabled = true;#}
    {#    btn.innerText = "Processing...";#}
    {##}
    {#    let progress = 0;#}
    {##}
    {#    const interval = setInterval(() => {#}
    {#        if (progress < 80) {#}
    {#            progress += 5;#}
    {#        } else if (progress < 95) {#}
    {#            progress += 1;#}
    {#        } else {#}
    {#            progress = 100;#}
    {#            clearInterval(interval);#}
    {##}
    {#            // ‚úÖ SAFE reload ‚Äî long enough for download to start#}
    {##}
    {#        }#}
    {##}
    {#        bar.style.width = progress + "%";#}
    {#        bar.textContent = progress + "%";#}
    {#    }, 300);#}
//    }
</script>

{% endblock %}

