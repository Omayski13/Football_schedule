{% extends 'base.html' %}

{% load add_days %}

{% block content %}

    <form method="post">
        {% csrf_token %}
        {{ form }}
        <button>Създай седмица</button>
    </form>

    <ul>
        {% for week in weeks %}
            <li>{{ week.start_date }} - {{ week.start_date|add_days:7 }}</li>
        {% endfor %}
    </ul>

    <button id="delete-weeks" class="btn btn-danger">Delete All Weeks</button>
    
{% endblock %}

    <script>
        document.getElementById('delete-weeks').addEventListener('click', function () {
            if (confirm('Are you sure you want to delete all weeks?')) {
                fetch(window.location.href, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}', // Include CSRF token
                        'Content-Type': 'application/json',
                    },
                })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                        location.reload(); // Reload the page after deletion
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while deleting weeks.');
                    });
            }
        });
    </script>